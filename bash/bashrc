export EDITOR=vim

stty -ixon # disable Ctrl-S

# avoid Ctrl-D spam exitting shells
set -o ignoreeof

export FZF_DEFAULT_COMMAND='rg --files --no-ignore --hidden --follow --glob "!.git/*"'

alias sl='ls'
alias lr='ls -lathr'

alias t='tmux'
alias tl='tmux list-sessions'
alias ta='tmux a -t'

alias rg80='rg -M 80'

function treel { # tree view current directory
    [ -n "$1" ] && DIR="$1" || DIR="."
    tree -DCf $DIR | less -rS
}

function tts {
    tmux new-session -t "$1" -s "$2"
}

function tlr { # tail the last modified file in current folder
    local FILE="$(ls -At | head -n 1)"
    echo "---- ${FILE}:"
    tail -n 30 -f "$FILE"
}

function vlr { # edit last modified file in current folder
    local FILE="$(ls -At | head -n 1)"
    vim "$FILE"
}

function validate_fzf_choice { 
    case "$1" in
        "") return 1;; 
        + ) return 1;;
        +\n) return 1;;
        +\t) return 1;;
        *) return 0;;
    esac
}

function cd_virtualenv {
    local VENV=$(ls -d $HOME/.virtualenvs/*/ | cut -d/ -f 5 | fzf)
    if [ -n "$VENV" ]; then
        echo "$HOME/.virtualenvs/$VENV/lib/python3.7/site-packages"
        cd "$HOME/.virtualenvs/$VENV/lib/python3.7/site-packages"
    fi
}

function wo {
    local VENV=$(lsvirtualenv -b | fzf)
    if [ -n "$VENV" ]; then
        echo "$VENV"
        workon "$VENV"
    fi
}

function flutter-hotreload {
    while true; do
        find . -name *.dart | entr -dnp bash -c 'tmux send-keys -t :flutter_run r' /_
    done
}
